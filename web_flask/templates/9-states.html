
web framework
web_flask/0-hello_route.py


#!/usr/bin/python3

""" Starts a Flash Web Application """

from flask import Flask

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def hello_hbnb():

    """ Prints a Message when / is called """

    return 'Hello HBNB!'


if __name__ == "__main__":

    """ Main Function """

    app.run(host='0.0.0.0', port=5000)


web_flask/1-hbnb_route.py


#!/usr/bin/python3

""" Starts a Flash Web Application HBNB"""

from flask import Flask

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def hello_hbnb():

    """ Prints a Message when / is called """

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """ Prints a Message when /hbnb is called """

    return 'HBNB'


if __name__ == "__main__":

    """ Main Function """

    app.run(host='0.0.0.0', port=5000)


web_flask/2-c_route.py


#!/usr/bin/python3

""" Starts a Flash Web Application C is FUN"""

from flask import Flask

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def hello_hbnb():

    """ Prints a Message when / is called """

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """ Prints a Message when /hbnb is called """

    return 'HBNB'



@app.route('/c/<text>', strict_slashes=False)

def c_is_fun(text):

    """ Prints a Message when /c is called """

    return "C " + text.replace('_', ' ')


if __name__ == "__main__":

    """ Main Function """

    app.run(host='0.0.0.0', port=5000)


web_flask/3-python_route.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def index():

    """returns Hello HBNB!"""

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """returns HBNB"""

    return 'HBNB'



@app.route('/c/<text>', strict_slashes=False)

def cisfun(text):

    """display “C ” followed by the value of the text variable"""

    return 'C ' + text.replace('_', ' ')



@app.route('/python', strict_slashes=False)

@app.route('/python/<text>', strict_slashes=False)

def pythoniscool(text='is cool'):

    """display “Python ”, followed by the value of the text variable"""

    return 'Python ' + text.replace('_', ' ')


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/4-number_route.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def index():

    """returns Hello HBNB!"""

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """returns HBNB"""

    return 'HBNB'



@app.route('/c/<text>', strict_slashes=False)

def cisfun(text):

    """display “C ” followed by the value of the text variable"""

    return 'C ' + text.replace('_', ' ')



@app.route('/python', strict_slashes=False)

@app.route('/python/<text>', strict_slashes=False)

def pythoniscool(text='is cool'):

    """display “Python ”, followed by the value of the text variable"""

    return 'Python ' + text.replace('_', ' ')



@app.route('/number/<int:n>', strict_slashes=False)

def imanumber(n):

    """display “n is a number” only if n is an integer"""

    return "{:d} is a number".format(n)


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/5-number_template.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def index():

    """returns Hello HBNB!"""

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """returns HBNB"""

    return 'HBNB'



@app.route('/c/<text>', strict_slashes=False)

def cisfun(text):

    """display “C ” followed by the value of the text variable"""

    return 'C ' + text.replace('_', ' ')



@app.route('/python', strict_slashes=False)

@app.route('/python/<text>', strict_slashes=False)

def pythoniscool(text='is cool'):

    """display “Python ”, followed by the value of the text variable"""

    return 'Python ' + text.replace('_', ' ')



@app.route('/number/<int:n>', strict_slashes=False)

def imanumber(n):

    """display “n is a number” only if n is an integer"""

    return "{:d} is a number".format(n)



@app.route('/number_template/<int:n>', strict_slashes=False)

def numbersandtemplates(n):

    """display a HTML page only if n is an integer"""

    return render_template('5-number.html', n=n)


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')



web_flask/6-number_odd_or_even.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

app = Flask(__name__)



@app.route('/', strict_slashes=False)

def index():

    """returns Hello HBNB!"""

    return 'Hello HBNB!'



@app.route('/hbnb', strict_slashes=False)

def hbnb():

    """returns HBNB"""

    return 'HBNB'



@app.route('/c/<text>', strict_slashes=False)

def cisfun(text):

    """display “C ” followed by the value of the text variable"""

    return 'C ' + text.replace('_', ' ')



@app.route('/python', strict_slashes=False)

@app.route('/python/<text>', strict_slashes=False)

def pythoniscool(text='is cool'):

    """display “Python ”, followed by the value of the text variable"""

    return 'Python ' + text.replace('_', ' ')



@app.route('/number/<int:n>', strict_slashes=False)

def imanumber(n):

    """display “n is a number” only if n is an integer"""

    return "{:d} is a number".format(n)



@app.route('/number_template/<int:n>', strict_slashes=False)

def numbersandtemplates(n):

    """display a HTML page only if n is an integer"""

    return render_template('5-number.html', n=n)



@app.route('/number_odd_or_even/<int:n>', strict_slashes=False)

def numbersandevenness(n):

    """display a HTML page only if n is an integer"""

    if n % 2 == 0:

        evenness = 'even'

    else:

        evenness = 'odd'

    return render_template('6-number_odd_or_even.html', n=n,

                           evenness=evenness)


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/7-states_list.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

from models import *

from models import storage

app = Flask(__name__)



@app.route('/states_list', strict_slashes=False)

def states_list():

    """display a HTML page with the states listed in alphabetical order"""

    states = sorted(list(storage.all("State").values()), key=lambda x: x.name)

    return render_template('7-states_list.html', states=states)



@app.teardown_appcontext

def teardown_db(exception):

    """closes the storage on teardown"""

    storage.close()


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/8-cities_by_states.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

from models import *

from models import storage

app = Flask(__name__)



@app.route('/cities_by_states', strict_slashes=False)

def cities_by_states():

    """display the states and cities listed in alphabetical order"""

    states = storage.all("State").values()

    return render_template('8-cities_by_states.html', states=states)



@app.teardown_appcontext

def teardown_db(exception):

    """closes the storage on teardown"""

    storage.close()


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/9-states.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

from models import *

from models import storage

app = Flask(__name__)



@app.route('/states', strict_slashes=False)

@app.route('/states/<state_id>', strict_slashes=False)

def states(state_id=None):

    """display the states and cities listed in alphabetical order"""

    states = storage.all("State")

    if state_id is not None:

        state_id = 'State.' + state_id

    return render_template('9-states.html', states=states, state_id=state_id)



@app.teardown_appcontext

def teardown_db(exception):

    """closes the storage on teardown"""

    storage.close()


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')


web_flask/10-hbnb_filters.py


#!/usr/bin/python3

"""

starts a Flask web application

"""


from flask import Flask, render_template

from models import *

from models import storage

app = Flask(__name__)



@app.route('/hbnb_filters', strict_slashes=False)

def filters():

    """display a HTML page like 6-index.html from static"""

    states = storage.all("State").values()

    amenities = storage.all("Amenity").values()

    return render_template('10-hbnb_filters.html', states=states,

                           amenities=amenities)



@app.teardown_appcontext

def teardown_db(exception):

    """closes the storage on teardown"""

    storage.close()


if __name__ == '__main__':

    app.run(host='0.0.0.0', port='5000')



models/engine/file_storage.py


#!/usr/bin/python3

"""Defines the FileStorage class."""

import json

from models.base_model import BaseModel

from models.amenity import Amenity

from models.city import City

from models.place import Place

from models.review import Review

from models.state import State

from models.user import User



class FileStorage:

    """Represent an abstracted storage engine.


    Attributes:

        __file_path (str): The name of the file to save objects to.

        __objects (dict): A dictionary of instantiated objects.

    """


    __file_path = "file.json"

    __objects = {}


    def all(self, cls=None):

        """Return a dictionary of instantiated objects in __objects.


        If a cls is specified, returns a dictionary of objects of that type.

        Otherwise, returns the __objects dictionary.

        """

        if cls is not None:

            if type(cls) == str:

                cls = eval(cls)

            cls_dict = {}

            for k, v in self.__objects.items():

                if type(v) == cls:

                    cls_dict[k] = v

            return cls_dict

        return self.__objects


    def new(self, obj):

        """Set in __objects obj with key <obj_class_name>.id."""

        self.__objects["{}.{}".format(type(obj).__name__, obj.id)] = obj


    def save(self):

        """Serialize __objects to the JSON file __file_path."""

        odict = {o: self.__objects[o].to_dict() for o in self.__objects.keys()}

        with open(self.__file_path, "w", encoding="utf-8") as f:

            json.dump(odict, f)


    def reload(self):

        """Deserialize the JSON file __file_path to __objects, if it exists."""

        try:

            with open(self.__file_path, "r", encoding="utf-8") as f:

                for o in json.load(f).values():

                    name = o["__class__"]

                    del o["__class__"]

                    self.new(eval(name)(**o))

        except FileNotFoundError:

            pass


    def delete(self, obj=None):

        """Delete a given object from __objects, if it exists."""

        try:

            del self.__objects["{}.{}".format(type(obj).__name__, obj.id)]

        except (AttributeError, KeyError):

            pass


    def close(self):

        """Call the reload method."""

        self.reload()



models/engine/db_storage.py


#!/usr/bin/python3

"""Defines the DBStorage engine."""

from os import getenv

from models.base_model import Base

from models.base_model import BaseModel

from models.amenity import Amenity

from models.city import City

from models.place import Place

from models.review import Review

from models.state import State

from models.user import User

from sqlalchemy import create_engine

from sqlalchemy.orm import relationship

from sqlalchemy.orm import scoped_session

from sqlalchemy.orm import sessionmaker



class DBStorage:

    """Represents a database storage engine.


    Attributes:

        __engine (sqlalchemy.Engine): The working SQLAlchemy engine.

        __session (sqlalchemy.Session): The working SQLAlchemy session.

    """


    __engine = None

    __session = None


    def __init__(self):

        """Initialize a new DBStorage instance."""

        self.__engine = create_engine("mysql+mysqldb://{}:{}@{}/{}".

                                      format(getenv("HBNB_MYSQL_USER"),

                                             getenv("HBNB_MYSQL_PWD"),

                                             getenv("HBNB_MYSQL_HOST"),

                                             getenv("HBNB_MYSQL_DB")),

                                      pool_pre_ping=True)

        if getenv("HBNB_ENV") == "test":

            Base.metadata.drop_all(self.__engine)


    def all(self, cls=None):

        """Query on the curret database session all objects of the given class.


        If cls is None, queries all types of objects.


        Return:

            Dict of queried classes in the format <class name>.<obj id> = obj.

        """

        if cls is None:

            objs = self.__session.query(State).all()

            objs.extend(self.__session.query(City).all())

            objs.extend(self.__session.query(User).all())

            objs.extend(self.__session.query(Place).all())

            objs.extend(self.__session.query(Review).all())

            objs.extend(self.__session.query(Amenity).all())

        else:

            if type(cls) == str:

                cls = eval(cls)

            objs = self.__session.query(cls)

        return {"{}.{}".format(type(o).__name__, o.id): o for o in objs}


    def new(self, obj):

        """Add obj to the current database session."""

        self.__session.add(obj)


    def save(self):

        """Commit all changes to the current database session."""

        self.__session.commit()


    def delete(self, obj=None):

        """Delete obj from the current database session."""

        if obj is not None:

            self.__session.delete(obj)


    def reload(self):

        """Create all tables in the database and initialize a new session."""

        Base.metadata.create_all(self.__engine)

        session_factory = sessionmaker(bind=self.__engine,

                                       expire_on_commit=False)

        Session = scoped_session(session_factory)

        self.__session = Session()


    def close(self):

        """Close the working SQLAlchemy session."""

        self.__session.close()



models/state.py


#!/usr/bin/python3

"""Defines the State class."""

import models

from sqlalchemy import Column, String

from sqlalchemy.orm import relationship

from models.base_model import BaseModel, Base

from models.city import City

from os import getenv



class State(BaseModel, Base):

    """Represents a state for a MySQL database.


    Inherits from SQLAlchemy Base and links to the MySQL table states.


    Attributes:

        __tablename__ (str): The name of the MySQL table to store States.

        name (sqlalchemy String): The name of the State.

        cities (sqlalchemy relationship): The State-City relationship.

    """

    __tablename__ = "states"

    name = Column(String(128), nullable=False)


    if getenv("HBNB_TYPE_STORAGE") == "db":

        cities = relationship("City", backref="state", cascade="all, delete")

    else:

        @property

        def cities(self):

            """Get a list of City instances with

                state_id equals to the current State.id.


            This is a getter attribute for FileStorage

                relationship between State and City.

            """

            city_list = []

            for city in models.storage.all(City).values():

                if city.state_id == self.id:

                    city_list.append(city)

            return city_list




web_flask/templates/5-number.html


<!DOCTYPE html>

<HTML lang="en">

    <HEAD>

        <TITLE>HBNB</TITLE>

    </HEAD>

    <BODY>

        <H1>Number: {{ n }}</H1>

    </BODY>

</HTML>


web_flask/templates/6-number_odd_or_even.html


<!DOCTYPE html>

<HTML lang="en">

    <HEAD>

        <TITLE>HBNB</TITLE>

    </HEAD>

    <BODY>

        <H1>Number: {{ n }} is {{ evenness }}</H1>

    </BODY>

</HTML>


web_flask/templates/7-states_list.html


<!DOCTYPE html>

<HTML lang="en">

    <HEAD>

        <TITLE>HBNB</TITLE>

    </HEAD>

    <BODY>

        <H1>States</H1>

        <UL>

        {% for state in states %}

            <LI>{{ state.id }}: <B>{{ state.name }}</B></LI>

        {% endfor %}

        </UL>

    </BODY>

</HTML>


web_flask/templates/8-cities_by_states.html


<!DOCTYPE html>

<HTML lang="en">

    <HEAD>

        <TITLE>HBNB</TITLE>

    </HEAD>

    <BODY>

        <H1>States</H1>

        <UL>

        {% for state in states|sort(attribute='name') %}

            <LI>{{ state.id }}: <B>{{ state.name }}</B>

                <UL>

                {% for city in state.cities|sort(attribute='name') %}

                    <LI>{{ city.id }}: <B>{{ city.name }}</B></LI>

                {% endfor %}

                </UL>

            </LI>

        {% endfor %}

        </UL>

    </BODY>

</HTML>


web_flask/templates/9-states.html


<!DOCTYPE html>

<HTML lang="en">

    <HEAD>

        <TITLE>HBNB</TITLE>

    </HEAD>

    <BODY>

        {% if not state_id %}

            <H1>States</H1>

            <UL>

                {% for state in states.values()|sort(attribute='name') %}

                    <LI>{{ state.id }}: <B>{{ state.name }}</B></LI>

                {% endfor %}

            </UL>

        {% elif state_id in states%}

            {% set state = states[state_id] %}

                <H1>State: {{ state.name }}</H1>

                <H3>Cities</H3>

                    <UL>

                        {% for city in state.cities|sort(attribute='name') %}

                            <LI>{{ city.id }}: <B>{{ city.name }}</B></LI>

                        {% endfor %}

                    </UL>

        {% else %}

            <H1>Not found!</H1>

        {% endif %}

    </BODY>

</HTML>
